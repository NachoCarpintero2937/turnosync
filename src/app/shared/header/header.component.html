<mat-toolbar color="primary" *ngIf="userData?.status && !excludePage" class="main-toolbar">
    <div class="header-container">
        <!-- Logo Section -->
        <div class="logo-section">
            <button mat-icon-button class="menu-trigger" (click)="toggleMobileMenu()">
                <mat-icon>{{ isMobileMenuOpen ? 'close' : 'menu' }}</mat-icon>
            </button>

            <a [routerLink]="['/logged/home']" class="logo-link">
                <img *ngIf="imgLogo?.configuration_value" [src]="imgLogo?.configuration_value" alt="Logo"
                    class="logo-image">
                <span *ngIf="!imgLogo?.configuration_value" class="company-name">
                    {{companyData?.name}}
                </span>
            </a>
        </div>

        <!-- Desktop Navigation -->
        <nav class="desktop-nav">
            <a mat-button class="nav-link" *ngxPermissionsOnly="['VIEW_HOME']" [routerLink]="['/in/home']"
                routerLinkActive="active">
                <mat-icon>home</mat-icon>
                <span>Inicio</span>
            </a>
            <a mat-button class="nav-link" *ngxPermissionsOnly="['VIEW_CLIENTS']" [routerLink]="['/in/clients']"
                routerLinkActive="active">
                <mat-icon>people</mat-icon>
                <span>Clientes</span>
            </a>
            <a mat-button class="nav-link" [routerLink]="['/in/diary']" routerLinkActive="active">
                <mat-icon>event_note</mat-icon>
                <span>Agenda</span>
            </a>
            <!-- Otros enlaces de navegación... -->
        </nav>

        <!-- Actions Section -->
        <div class="actions-section">
            <!-- Time -->
            <div class="time-display">
                {{ hour }}
            </div>

            <!-- Tasks -->
            <div class="tasks-indicator" *ngIf="tasksData?.length" [matMenuTriggerFor]="tasksMenu">
                <mat-spinner diameter="20"></mat-spinner>
                <span class="tasks-count">
                    {{tasksData?.length}} Tarea(s)
                    {{tasksData[0]?.status === 'processing' ? 'corriendo' : 'en espera'}}
                    <mat-icon>expand_more</mat-icon>
                </span>
            </div>

            <!-- Notifications -->
            <button mat-icon-button class="notification-btn" (click)="openBottomSheet()">
                <mat-icon [matBadge]="notifications.length" matBadgeColor="warn"
                    [matBadgeHidden]="!notifications.length">
                    notifications
                </mat-icon>
            </button>

            <!-- Settings -->
            <button mat-icon-button [matMenuTriggerFor]="settingsMenu">
                <mat-icon>settings</mat-icon>
            </button>

            <!-- User Menu -->
            <div class="user-menu">
                <app-iniciales [matMenuTriggerFor]="userMenu" [text]="userData?.data?.name" color="#eaeaea" size="15px"
                    width="40px" height="40px">
                </app-iniciales>
                <button mat-icon-button class="logout-btn" (click)="logout(companyData?.id)">
                    <mat-icon>logout</mat-icon>
                </button>
            </div>
        </div>
    </div>
</mat-toolbar>

<!-- Mobile Menu -->
<div class="mobile-menu" [class.open]="isMobileMenuOpen">
    <mat-nav-list>
        <a mat-list-item *ngFor="let item of navigationItems" [routerLink]="item.route" routerLinkActive="active"
            (click)="toggleMobileMenu()" [ngxPermissionsOnly]="[item.permission]">
            <mat-icon matListItemIcon>{{item.icon}}</mat-icon>
            <span matListItemTitle>{{item.label}}</span>
        </a>
    </mat-nav-list>
</div>

<!-- Menus -->
<mat-menu #tasksMenu="matMenu" class="tasks-menu">
    <div mat-menu-item *ngFor="let task of tasksData" class="task-item">
        <mat-icon *ngIf="task?.status === 'processing'">sync</mat-icon>
        <mat-icon *ngIf="task?.status !== 'processing'">schedule</mat-icon>
        <span>
            Campaña de {{task?.type === 'email' ? 'emails' : 'WhatsApp'}}
            <small *ngIf="task?.status === 'processing'">({{task?.percentage_completed}}%)</small>
        </span>
    </div>
</mat-menu>

<mat-menu #settingsMenu="matMenu">
    <a mat-menu-item [routerLink]="['/in/settings/']" *ngxPermissionsOnly="['VIEW_SETTINGS']">
        <mat-icon>settings</mat-icon>
        <span>Ajustes de la empresa</span>
    </a>
    <mat-divider></mat-divider>
    <a mat-menu-item [routerLink]="['/in/users/view-user']" [queryParams]="{id: userData?.data?.id}">
        <mat-icon>person</mat-icon>
        <span>Cuenta</span>
    </a>
</mat-menu>

<mat-menu #userMenu="matMenu">
    <div class="user-menu-header">
        <app-iniciales [text]="userData?.data?.name" color="#eaeaea" size="20px" width="60px" height="60px">
        </app-iniciales>
        <div class="user-info">
            <h4>{{userData?.data?.name}}</h4>
            <small>{{userData?.data?.email}}</small>
        </div>
    </div>
    <mat-divider></mat-divider>
    <button mat-menu-item (click)="logout(companyData?.id)">
        <mat-icon>logout</mat-icon>
        <span>Cerrar sesión</span>
    </button>
</mat-menu>