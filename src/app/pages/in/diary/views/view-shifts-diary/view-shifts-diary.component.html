<mat-card class="shifts-card mat-elevation-z0">
    <mat-card-header class="shifts-header">
        <mat-card-title class="header-title">
            Turnos de {{getMonthName()}}
        </mat-card-title>

        <div class="status-legend">
            <div class="legend-item">
                <div class="status-indicator show"></div>
                <span>Asistió</span>
            </div>
            <div class="legend-item">
                <div class="status-indicator no-show"></div>
                <span>No asistió / Cancelada</span>
            </div>
            <div class="legend-item">
                <div class="status-indicator pending"></div>
                <span>Pendiente</span>
            </div>
        </div>
    </mat-card-header>

    <mat-card-content class="shifts-content">
        <div *ngIf="date" class="date-filter">
            <button mat-flat-button color="primary" (click)="filterDate()">
                <b>{{date | date : 'dd/MM'}}</b>
            </button>
        </div>

        <ng-container *ngIf="!loading; else loadingTpl">
            <div class="shifts-list" *ngIf="shifts.length > 0; else noShifts">
                <mat-accordion>
                    <mat-expansion-panel *ngFor="let dateShift of shifts" class="shift-panel mat-elevation-z0">
                        <mat-expansion-panel-header>
                            <mat-panel-title class="panel-title">
                                <div class="date-with-badge">
                                    <span>{{dateShift?.date | date : 'dd/MM/yyyy'}}</span>
                                    <mat-chip-listbox>
                                        <mat-chip color="primary" selected>
                                            {{dateShift?.shifts?.length}}
                                        </mat-chip>
                                    </mat-chip-listbox>
                                </div>
                            </mat-panel-title>
                        </mat-expansion-panel-header>

                        <mat-list>
                            <mat-list-item *ngFor="let shift of dateShift?.shifts"
                                [class]="'shift-item status-' + shift?.status">
                                <div class="shift-content">
                                    <div class="shift-info">
                                        <span class="shift-time">
                                            {{ shift?.date_shift | date:'HH:mm' }}
                                        </span>
                                        <span class="shift-description" [matTooltip]="getTootlip(shift)">
                                            {{shift?.service?.name}} - <b>{{shift?.client?.name}}</b>
                                        </span>
                                        <span class="shift-price">
                                            {{ shift?.price | currency:'$':'symbol':'1.2-2' }}
                                        </span>
                                    </div>

                                    <div class="shift-actions">
                                        <ng-container *ngIf="shift?.status === 0">
                                            <button mat-icon-button color="primary"
                                                *ngxPermissionsOnly="['CONFIRM_SHIFT']" (click)="changeStatus(shift,1)"
                                                matTooltip="Confirmar">
                                                <mat-icon>done</mat-icon>
                                            </button>
                                            <button mat-icon-button color="warn" *ngxPermissionsOnly="['CANCEL_SHIFT']"
                                                (click)="changeStatus(shift,2)" matTooltip="Cancelar">
                                                <mat-icon>close</mat-icon>
                                            </button>
                                        </ng-container>
                                        <button mat-icon-button (click)="sendWsp(shift)" matTooltip="WhatsApp">
                                            <img src="./assets/img/wsp.png" alt="WhatsApp" width="20">
                                        </button>
                                        <a mat-icon-button [routerLink]="['/in/shifts/view-shift']"
                                            [queryParams]="{id: shift?.id}" matTooltip="Ver detalle">
                                            <mat-icon>search</mat-icon>
                                        </a>
                                    </div>
                                </div>
                            </mat-list-item>
                        </mat-list>
                    </mat-expansion-panel>
                </mat-accordion>
            </div>
        </ng-container>

        <ng-template #noShifts>
            <div class="no-shifts-message">
                <mat-icon>event_busy</mat-icon>
                <span>Sin turnos para esta fecha</span>
            </div>
        </ng-template>

        <ng-template #loadingTpl>
            <div class="loading-container">
                <mat-spinner diameter="40"></mat-spinner>
            </div>
        </ng-template>
    </mat-card-content>
</mat-card>